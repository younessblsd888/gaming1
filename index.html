<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subway Surfers Mini</title>
    <meta property="og:title" content="Subway Surfers Mini Game" />
    <meta property="og:description" content="Jump, collect coins, and chase your highscore in this pixel mini-game!" />
    <meta property="og:image" content="https://raw.githubusercontent.com/enchanted-assets/public/main/images/tetris-cover.png" />
    <meta name="theme-color" content="#000000" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: "Press Start 2P", monospace;
        background: linear-gradient(180deg, #111, #333);
        color: #fff;
        text-align: center;
        overflow: hidden;
      }

      .menu, .game, .gameover {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .menu.active, .game.active, .gameover.active {
        display: flex;
      }

      .player {
        position: absolute;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 60px;
        background: #00f;
        border-radius: 4px;
      }

      .coin {
        position: absolute;
        width: 20px;
        height: 20px;
        background: gold;
        border-radius: 50%;
      }

      button {
        margin-top: 20px;
        background: #ff3b3b;
        border: none;
        color: #fff;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
      }

      button:hover {
        background: #ff6363;
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <!-- Menu Screen -->
    <div id="menu" class="menu active">
      <h1>SUBWAY SURFERS MINI</h1>
      <p id="highscoreText">HIGH SCORE: 0</p>
      <button onclick="startGame()">START</button>
    </div>

    <!-- Game Screen -->
    <div id="game" class="game">
      <canvas id="gameCanvas" width="400" height="600"></canvas>
      <div id="player" class="player"></div>
      <p id="scoreText" style="position: absolute; top: 20px; left: 20px;">SCORE: 0</p>
      <p id="coinsText" style="position: absolute; top: 50px; left: 20px;">COINS: 0</p>
    </div>

    <!-- Game Over Screen -->
    <div id="gameover" class="gameover">
      <h1>GAME OVER</h1>
      <p id="finalScore">SCORE: 0</p>
      <button onclick="startGame()">RETRY</button>
    </div>

    <script>
      let score = 0;
      let coins = 0;
      let highscore = parseInt(localStorage.getItem("subway-highscore") || "0");
      let gameRunning = false;
      let coinElements = [];
      let player;
      let playerY = 0;
      let velocity = 0;
      let gravity = 0.8;
      let jumpPower = -12;
      let gameLoop;
      let ctx;

      const menu = document.getElementById("menu");
      const game = document.getElementById("game");
      const gameover = document.getElementById("gameover");
      const scoreText = document.getElementById("scoreText");
      const coinsText = document.getElementById("coinsText");
      const highscoreText = document.getElementById("highscoreText");
      const finalScore = document.getElementById("finalScore");
      const canvas = document.getElementById("gameCanvas");

      ctx = canvas.getContext("2d");
      highscoreText.textContent = "HIGH SCORE: " + highscore;

      function startGame() {
        score = 0;
        coins = 0;
        playerY = 0;
        velocity = 0;
        gameRunning = true;
        coinElements.forEach(c => c.remove());
        coinElements = [];

        menu.classList.remove("active");
        gameover.classList.remove("active");
        game.classList.add("active");

        player = document.getElementById("player");
        player.style.bottom = "100px";

        spawnCoins();
        gameLoop = setInterval(updateGame, 30);
      }

      function spawnCoins() {
        for (let i = 0; i < 3; i++) {
          const coin = document.createElement("div");
          coin.classList.add("coin");
          coin.style.left = Math.random() * 360 + "px";
          coin.style.top = Math.random() * 400 + "px";
          game.appendChild(coin);
          coinElements.push(coin);
        }
      }

      function updateGame() {
        score++;
        scoreText.textContent = "SCORE: " + score;
        coinsText.textContent = "COINS: " + coins;

        velocity += gravity;
        playerY += velocity;
        if (playerY > 0) {
          playerY = 0;
          velocity = 0;
        }

        player.style.bottom = 100 + playerY + "px";

        // Collision detection
        coinElements.forEach((coin, i) => {
          const coinRect = coin.getBoundingClientRect();
          const playerRect = player.getBoundingClientRect();
          if (
            coinRect.left < playerRect.right &&
            coinRect.right > playerRect.left &&
            coinRect.top < playerRect.bottom &&
            coinRect.bottom > playerRect.top
          ) {
            coins++;
            coin.remove();
            coinElements.splice(i, 1);
            spawnCoins();
          }
        });

        // End game condition
        if (score > 9999) endGame();
      }

      function endGame() {
        clearInterval(gameLoop);
        gameRunning = false;
        game.classList.remove("active");
        gameover.classList.add("active");
        finalScore.textContent = "SCORE: " + score;

        if (score > highscore) {
          highscore = score;
          localStorage.setItem("subway-highscore", highscore.toString());
        }

        highscoreText.textContent = "HIGH SCORE: " + highscore;
      }

      document.body.addEventListener("keydown", (e) => {
        if (e.code === "Space" && playerY === 0) {
          velocity = jumpPower;
        }
      });

      document.body.addEventListener("click", () => {
        if (gameRunning && playerY === 0) {
          velocity = jumpPower;
        }
      });
    </script>
  </body>
</html>
